Feature: Simple Test # features/test_simple.feature:1
  As a developer
  I want to test the BDD setup
  So that I can verify everything works
  @smoke
  Scenario: Simple test scenario        # features/test_simple.feature:7
    Given the application is running    # features/steps/authentication_steps.py:12
    Then I should see a success message # features/steps/email_verification_steps.py:156

Feature: API Endpoints # features/api/api_endpoints.feature:1
  As a developer
  I want to access the application via API endpoints
  So that I can integrate with other systems
  Feature: API Endpoints  # features/api/api_endpoints.feature:1

  @smoke @api
  Scenario: Get prayer times via API                     # features/api/api_endpoints.feature:11
    Given the application is running                     # features/steps/authentication_steps.py:12
    And the API is accessible                            # features/steps/api_steps.py:13
    Given I have a valid API token                       # features/steps/api_steps.py:21
    When I make a GET request to "/api/prayers/times"    # features/steps/api_steps.py:63
    Then I should receive a 200 response                 # features/steps/api_steps.py:233
      ASSERT FAILED: Expected status code 200, but got 422

    And the response should contain today's prayer times # None
    And the response should be in JSON format            # None

  @api
  Scenario: Complete prayer via API                                                              # features/api/api_endpoints.feature:19
    Given the application is running                                                             # None
    And the API is accessible                                                                    # None
    Given I have a valid API token                                                               # None
    And I am within the Dhuhr prayer time window                                                 # None
    When I make a POST request to "/api/prayers/complete" With the prayer ID and completion time # None
    Then I should receive a 200 response                                                         # None
    And the prayer should be marked as completed                                                 # None
    And the response should contain success message                                              # None

  @api
  Scenario: Get dashboard statistics via API                # features/api/api_endpoints.feature:28
    Given the application is running                        # None
    And the API is accessible                               # None
    Given I have a valid API token                          # None
    And I have prayer completion history                    # None
    When I make a GET request to "/api/dashboard/stats"     # None
    Then I should receive a 200 response                    # None
    And the response should contain completion statistics   # None
    And the response should contain weekly and monthly data # None

  @api
  Scenario: API authentication with invalid token           # features/api/api_endpoints.feature:37
    Given the application is running                        # None
    And the API is accessible                               # None
    Given I have an invalid API token                       # None
    When I make a GET request to "/api/prayers/times"       # None
    Then I should receive a 401 response                    # None
    And the response should contain an authentication error # None

  @api
  Scenario: API rate limiting                                        # features/api/api_endpoints.feature:44
    Given the application is running                                 # None
    And the API is accessible                                        # None
    Given I have a valid API token                                   # None
    When I make 100 requests to "/api/prayers/times" within 1 minute # None
    Then I should be rate limited                                    # None
    And I should receive a 429 response                              # None
    And the response should contain rate limit information           # None

  @api
  Scenario: API input validation                                                 # features/api/api_endpoints.feature:52
    Given the application is running                                             # None
    And the API is accessible                                                    # None
    Given I have a valid API token                                               # None
    When I make a POST request to "/api/prayers/complete" With invalid prayer ID # None
    Then I should receive a 400 response                                         # None
    And the response should contain validation error                             # None

  @api
  Scenario: API error handling                        # features/api/api_endpoints.feature:59
    Given the application is running                  # None
    And the API is accessible                         # None
    Given I have a valid API token                    # None
    When I make a request to a non-existent endpoint  # None
    Then I should receive a 404 response              # None
    And the response should contain a not found error # None

  @api
  Scenario: API response format consistency                   # features/api/api_endpoints.feature:66
    Given the application is running                          # None
    And the API is accessible                                 # None
    Given I have a valid API token                            # None
    When I make requests to various API endpoints             # None
    Then all responses should follow the same format          # None
    And all responses should include appropriate status codes # None
    And all responses should include error handling           # None

  @api
  Scenario: API versioning                               # features/api/api_endpoints.feature:74
    Given the application is running                     # None
    And the API is accessible                            # None
    Given I have a valid API token                       # None
    When I make a request to "/api/v1/prayers/times"     # None
    Then I should receive a 200 response                 # None
    And the response should be compatible with version 1 # None

  @api
  Scenario: API documentation accessibility              # features/api/api_endpoints.feature:81
    Given the application is running                     # None
    And the API is accessible                            # None
    When I make a GET request to "/api/docs"             # None
    Then I should receive a 200 response                 # None
    And the response should contain API documentation    # None
    And the documentation should be in a readable format # None

Feature: Password Reset # features/authentication/password_reset.feature:1
  As a user who forgot their password
  I want to reset my password using my email
  So that I can regain access to my account
  Feature: Password Reset  # features/authentication/password_reset.feature:1

  @smoke @api
  Scenario: Successful password reset flow                                        # features/authentication/password_reset.feature:12
    Given the application is running                                              # features/steps/authentication_steps.py:12
    And the database is clean                                                     # features/steps/authentication_steps.py:20
    And a user with email "test@example.com" and password "oldpassword123" exists # features/steps/authentication_steps.py:40
    Given I am on the login page                                                  # features/steps/authentication_steps.py:34
    When I click "Forgot Password"                                                # features/steps/authentication_steps.py:370
    And I enter my email for password reset "test@example.com"                    # features/steps/authentication_steps.py:376
    And I submit the forgot password form                                         # features/steps/authentication_steps.py:382
    Then I should receive a password reset email                                  # features/steps/authentication_steps.py:389
    And I should see a success message                                            # features/steps/email_verification_steps.py:156

  @smoke @api
  Scenario: Reset password with valid code                                        # features/authentication/password_reset.feature:21
    Given the application is running                                              # features/steps/authentication_steps.py:12
    And the database is clean                                                     # features/steps/authentication_steps.py:20
    And a user with email "test@example.com" and password "oldpassword123" exists # features/steps/authentication_steps.py:40
    Given I have a valid password reset code for "test@example.com"               # features/steps/authentication_steps.py:396
    When I navigate to the reset password page with the code                      # features/steps/authentication_steps.py:451
    And I enter a new password "newpassword123"                                   # features/steps/authentication_steps.py:460
    And I confirm the new password "newpassword123"                               # features/steps/authentication_steps.py:466
    And I submit the reset password form                                          # features/steps/authentication_steps.py:472
    Then my password should be reset successfully                                 # features/steps/authentication_steps.py:482
    And I should be able to login with the new password                           # features/steps/authentication_steps.py:489

  @smoke @api
  Scenario: Reset password with invalid code                                      # features/authentication/password_reset.feature:31
    Given the application is running                                              # features/steps/authentication_steps.py:12
    And the database is clean                                                     # features/steps/authentication_steps.py:20
    And a user with email "test@example.com" and password "oldpassword123" exists # features/steps/authentication_steps.py:40
    Given I have an invalid password reset code                                   # features/steps/authentication_steps.py:419
    When I navigate to the reset password page with the code                      # features/steps/authentication_steps.py:451
    Then I should see an error message about invalid code                         # features/steps/authentication_steps.py:501

  @smoke @api
  Scenario: Reset password with expired code                                      # features/authentication/password_reset.feature:37
    Given the application is running                                              # features/steps/authentication_steps.py:12
    And the database is clean                                                     # features/steps/authentication_steps.py:20
    And a user with email "test@example.com" and password "oldpassword123" exists # features/steps/authentication_steps.py:40
    Given I have an expired password reset code for "test@example.com"            # features/steps/authentication_steps.py:425
    When I navigate to the reset password page with the code                      # features/steps/authentication_steps.py:451
    Then I should see an error message about expired code                         # features/steps/authentication_steps.py:508

Feature: Simple Authentication Test # features/authentication/simple_auth_test.feature:1
  As a developer
  I want to test basic authentication functionality
  So that I can verify the BDD setup works
  @smoke
  Scenario: Test basic authentication setup          # features/authentication/simple_auth_test.feature:7
    Given the application is running                 # features/steps/authentication_steps.py:12
    And the database is clean                        # features/steps/authentication_steps.py:20
    When I check if authentication is available      # features/steps/simple_auth_steps.py:14
    Then I should see that authentication is working # features/steps/simple_auth_steps.py:21

Feature: User Login # features/authentication/user_login.feature:1
  As a registered user
  I want to log in to my account
  So that I can access my prayer tracking features
  Feature: User Login  # features/authentication/user_login.feature:1

  @smoke @api
  Scenario: Successful login with username and password                            # features/authentication/user_login.feature:11
    Given the application is running                                               # features/steps/authentication_steps.py:12
    And a user with email "testuser@example.com" and password "password123" exists # features/steps/authentication_steps.py:40
    Given I am on the login page                                                   # features/steps/authentication_steps.py:34
    When I enter email "testuser@example.com"                                      # features/steps/authentication_steps.py:156
    And I enter password "password123"                                             # features/steps/authentication_steps.py:170
    Then I should be logged in successfully                                        # features/steps/authentication_steps.py:278
      Traceback (most recent call last):
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/behave/model.py", line 1991, in run
          match.run(runner.context)
          ~~~~~~~~~^^^^^^^^^^^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/behave/matchers.py", line 105, in run
          self.func(context, *args, **kwargs)
          ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "features/steps/authentication_steps.py", line 281, in step_logged_in_successfully
          assert context.login_result['success'], f"Expected true but got false"
                 ^^^^^^^^^^^^^^^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/behave/runner.py", line 430, in __getattr__
          raise AttributeError(msg)
      AttributeError: 'Context' object has no attribute 'login_result'

    And I should be redirected to the prayers page                                 # None
    And I should see my user profile information                                   # None

  @api
  Scenario: Login with OTP                                                         # features/authentication/user_login.feature:20
    Given the application is running                                               # None
    And a user with email "testuser@example.com" and password "password123" exists # None
    Given I am on the login page                                                   # None
    When I switch to OTP login tab                                                 # None
    And I enter my email "testuser@example.com"                                    # None
    And I click "Send Code"                                                        # None
    Then I should receive an OTP code via email                                    # None
    When I enter the OTP code                                                      # None
    And I click "Login with Code"                                                  # None
    Then I should be logged in successfully                                        # None

  @api
  Scenario: Failed login with incorrect password                                   # features/authentication/user_login.feature:31
    Given the application is running                                               # None
    And a user with email "testuser@example.com" and password "password123" exists # None
    Given I am on the login page                                                   # None
    When I enter email "testuser@example.com"                                      # None
    And I enter password "wrongpassword"                                           # None
    And I click the login button with email                                        # None
    Then I should see an error message "Invalid email or password"                 # None
    And I should not be logged in                                                  # None

  @api
  Scenario: Failed login with non-existent username                                # features/authentication/user_login.feature:40
    Given the application is running                                               # None
    And a user with email "testuser@example.com" and password "password123" exists # None
    Given I am on the login page                                                   # None
    When I enter username "nonexistent"                                            # None
    And I enter password "password123"                                             # None
    And I click the login button with username                                     # None
    Then I should see an error message "Invalid email or password"                 # None
    And I should not be logged in                                                  # None

  @api
  Scenario: Login with invalid OTP                                                 # features/authentication/user_login.feature:49
    Given the application is running                                               # None
    And a user with email "testuser@example.com" and password "password123" exists # None
    Given I am on the login page                                                   # None
    And I have an invalid OTP code "123" and email: "testuser@example.com"         # None
    When I enter the invalid OTP code                                              # None
    And I click "Login with Code"                                                  # None
    Then I should see an error message "Invalid verification code"                 # None

  @ui
  Scenario: Login form validation                                                  # features/authentication/user_login.feature:57
    Given the application is running                                               # None
    And a user with email "testuser@example.com" and password "password123" exists # None
    Given I am on the login page                                                   # None
    When I leave the username field empty                                          # None
    And I try to submit the form                                                   # None
    Then I should see a validation error for the username field                    # None
    And the form should not be submitted                                           # None

Feature: User Registration # features/authentication/user_registration.feature:1
  As a new user
  I want to register for an account
  So that I can track my prayers and receive reminders
  Feature: User Registration  # features/authentication/user_registration.feature:1

  @smoke @api
  Scenario: Successful user registration                 # features/authentication/user_registration.feature:11
    Given the application is running                     # features/steps/authentication_steps.py:12
    And the database is clean                            # features/steps/authentication_steps.py:20
    Given I am on the registration page                  # features/steps/authentication_steps.py:28
    When I fill in the registration form with:           # features/steps/authentication_steps.py:127
      | Field      | Value             |
      | username   | testuser123       |
      | email      | test@example.com  |
      | password   | securepassword123 |
      | first_name | Test              |
      | last_name  | User              |
    And I submit the registration form                   # features/steps/authentication_steps.py:135
    Then I should be registered successfully             # features/steps/authentication_steps.py:232
    And I should receive a confirmation message          # features/steps/authentication_steps.py:240
    And I should be automatically logged in              # features/steps/authentication_steps.py:246
    And an email verification should be sent to my email # features/steps/authentication_steps.py:252

  @api
  Scenario: Registration with duplicate email                                # features/authentication/user_registration.feature:27
    Given the application is running                                         # None
    And the database is clean                                                # None
    Given a user with email "existing@example.com" already exists            # None
    When I try to register with email "existing@example.com"                 # None
    Then I should see an error message "User with this email already exists" # None
    And I should not be registered                                           # None

  @api
  Scenario: Registration with invalid email format                # features/authentication/user_registration.feature:34
    Given the application is running                              # None
    And the database is clean                                     # None
    When I try to register with email "invalid-email"             # None
    Then I should see an error message about invalid email format # None

  @api
  Scenario: Registration with weak password                        # features/authentication/user_registration.feature:39
    Given the application is running                               # None
    And the database is clean                                      # None
    When I try to register with password "123"                     # None
    Then I should see an error message about password requirements # None
    And I should not be registered                                 # None

  @api
  Scenario: Registration with missing required fields                   # features/authentication/user_registration.feature:45
    Given the application is running                                    # None
    And the database is clean                                           # None
    When I submit the registration form without filling required fields # None
    Then I should see error messages for missing fields                 # None
    And I should not be registered                                      # None

Feature: Dashboard Statistics # features/dashboard/dashboard_statistics.feature:1
  As a logged-in user
  I want to view my prayer statistics
  So that I can track my prayer consistency and progress
  Feature: Dashboard Statistics  # features/dashboard/dashboard_statistics.feature:1

  @smoke @api
  Scenario: View dashboard statistics                 # features/dashboard/dashboard_statistics.feature:12
    Given the application is running                  # features/steps/authentication_steps.py:12
    And I am logged in as a user                      # features/steps/prayer_completion_steps.py:15
    And I have prayer completion history              # features/steps/api_steps.py:56
    Given I am on the dashboard page                  # features/steps/dashboard_steps.py:13
    When the page loads                               # features/steps/dashboard_steps.py:48
    Then I should see my prayer completion statistics # features/steps/dashboard_steps.py:123
      ASSERT FAILED:

    And I should see today's completion rate          # None
    And I should see this week's completion rate      # None
    And I should see this month's completion rate     # None

  @api
  Scenario: Dashboard statistics with no prayer history                 # features/dashboard/dashboard_statistics.feature:21
    Given the application is running                                    # None
    And I am logged in as a user                                        # None
    And I have prayer completion history                                # None
    Given I am a new user with no prayer completions                    # None
    When I navigate to the dashboard                                    # None
    Then I should see zero completion rates                             # None
    And I should see a message encouraging me to start tracking prayers # None

  @api
  Scenario: Dashboard statistics with mixed completion status  # features/dashboard/dashboard_statistics.feature:28
    Given the application is running                           # None
    And I am logged in as a user                               # None
    And I have prayer completion history                       # None
    Given I have completed some prayers and missed others      # None
    When I view the dashboard statistics                       # None
    Then I should see accurate completion percentages          # None
    And I should see the count of completed prayers            # None
    And I should see the count of missed prayers               # None
    And I should see the count of qada prayers                 # None

  @ui
  Scenario: Dashboard calendar view                              # features/dashboard/dashboard_statistics.feature:37
    Given the application is running                             # None
    And I am logged in as a user                                 # None
    And I have prayer completion history                         # None
    Given I am on the dashboard page                             # None
    When I view the weekly calendar                              # None
    Then I should see prayer completion status for each day      # None
    And completed prayers should be marked with green indicators # None
    And missed prayers should be marked with red indicators      # None
    And pending prayers should be marked with yellow indicators  # None

  @ui
  Scenario: Dashboard navigation between weeks        # features/dashboard/dashboard_statistics.feature:46
    Given the application is running                  # None
    And I am logged in as a user                      # None
    And I have prayer completion history              # None
    Given I am on the dashboard page                  # None
    When I click the "Previous Week" button           # None
    Then I should see the previous week's prayer data # None
    When I click the "Next Week" button               # None
    Then I should see the next week's prayer data     # None

  @api
  Scenario: Dashboard statistics for specific date range    # features/dashboard/dashboard_statistics.feature:54
    Given the application is running                        # None
    And I am logged in as a user                            # None
    And I have prayer completion history                    # None
    Given I am on the dashboard page                        # None
    When I select a specific date range                     # None
    Then I should see statistics only for that date range   # None
    And the completion rates should be calculated correctly # None

  @api
  Scenario: Dashboard statistics with timezone handling         # features/dashboard/dashboard_statistics.feature:61
    Given the application is running                            # None
    And I am logged in as a user                                # None
    And I have prayer completion history                        # None
    Given I am in timezone "Asia/Kolkata"                       # None
    When I view the dashboard statistics                        # None
    Then the prayer times should be displayed in my timezone    # None
    And the completion times should be accurate for my timezone # None

  @ui
  Scenario: Dashboard responsive design          # features/dashboard/dashboard_statistics.feature:68
    Given the application is running             # None
    And I am logged in as a user                 # None
    And I have prayer completion history         # None
    Given I am on the dashboard page             # None
    When I view the page on a mobile device      # None
    Then the dashboard should be responsive      # None
    And all statistics should be clearly visible # None
    And the calendar should be touch-friendly    # None

  @api
  Scenario: Dashboard statistics caching         # features/dashboard/dashboard_statistics.feature:76
    Given the application is running             # None
    And I am logged in as a user                 # None
    And I have prayer completion history         # None
    Given I am on the dashboard page             # None
    When I view the statistics multiple times    # None
    Then the data should be cached appropriately # None
    And subsequent requests should be faster     # None
    And the data should remain accurate          # None

  @api
  Scenario: Dashboard statistics with family members     # features/dashboard/dashboard_statistics.feature:84
    Given the application is running                     # None
    And I am logged in as a user                         # None
    And I have prayer completion history                 # None
    Given I have family members added to my account      # None
    When I view the dashboard                            # None
    Then I should see statistics for my family members   # None
    And I should be able to filter by family member      # None
    And I should see aggregate statistics for the family # None

Feature: Email Verification # features/email_verification/email_verification.feature:1
  As a registered user
  I want to verify my email address
  So that I can receive prayer reminders and notifications
  Feature: Email Verification  # features/email_verification/email_verification.feature:1

  @smoke @api
  Scenario: Successful email verification              # features/email_verification/email_verification.feature:11
    Given the application is running                   # features/steps/authentication_steps.py:12
    And a user with unverified email exists            # features/steps/authentication_steps.py:89
    Given I am a registered user with unverified email # features/steps/authentication_steps.py:72
      Traceback (most recent call last):
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
          self.dialect.do_execute(
          ~~~~~~~~~~~~~~~~~~~~~~~^
              cursor, str_statement, effective_parameters, context
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          )
          ^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
          cursor.execute(statement, parameters)
          ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 615, in execute
          self._handle_result(self._connection.cmd_query(stmt))
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1046, in cmd_query
          result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 824, in _handle_result
          raise get_exception(packet)
      mysql.connector.errors.IntegrityError: 1062 (23000): Duplicate entry 'unverifieduser' for key 'users.username'
      
      The above exception was the direct cause of the following exception:
      
      Traceback (most recent call last):
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/behave/model.py", line 1991, in run
          match.run(runner.context)
          ~~~~~~~~~^^^^^^^^^^^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/behave/matchers.py", line 105, in run
          self.func(context, *args, **kwargs)
          ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "features/steps/authentication_steps.py", line 85, in step_user_with_unverified_email
          context.db.session.commit()
          ~~~~~~~~~~~~~~~~~~~~~~~~~^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/scoping.py", line 599, in commit
          return self._proxied.commit()
                 ~~~~~~~~~~~~~~~~~~~~^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
          trans.commit(_to_root=True)
          ~~~~~~~~~~~~^^^^^^^^^^^^^^^
        File "<string>", line 2, in commit
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
          ret_value = fn(self, *arg, **kw)
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
          self._prepare_impl()
          ~~~~~~~~~~~~~~~~~~^^
        File "<string>", line 2, in _prepare_impl
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
          ret_value = fn(self, *arg, **kw)
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
          self.session.flush()
          ~~~~~~~~~~~~~~~~~~^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4345, in flush
          self._flush(objects)
          ~~~~~~~~~~~^^^^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4480, in _flush
          with util.safe_reraise():
               ~~~~~~~~~~~~~~~~~^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
          raise exc_value.with_traceback(exc_tb)
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4441, in _flush
          flush_context.execute()
          ~~~~~~~~~~~~~~~~~~~~~^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
          rec.execute(self)
          ~~~~~~~~~~~^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
          util.preloaded.orm_persistence.save_obj(
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
              self.mapper,
              ^^^^^^^^^^^^
              uow.states_for_mapper_hierarchy(self.mapper, False, False),
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
              uow,
              ^^^^
          )
          ^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
          _emit_insert_statements(
          ~~~~~~~~~~~~~~~~~~~~~~~^
              base_mapper,
              ^^^^^^^^^^^^
          ...<3 lines>...
              insert,
              ^^^^^^^
          )
          ^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
          result = connection.execute(
              statement,
              params,
              execution_options=execution_options,
          )
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
          return meth(
              self,
              distilled_parameters,
              execution_options or NO_OPTIONS,
          )
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
          return connection._execute_clauseelement(
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
              self, distilled_params, execution_options
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          )
          ^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
          ret = self._execute_context(
              dialect,
          ...<8 lines>...
              cache_hit=cache_hit,
          )
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
          return self._exec_single_context(
                 ~~~~~~~~~~~~~~~~~~~~~~~~~^
              dialect, context, statement, parameters
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          )
          ^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
          self._handle_dbapi_exception(
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
              e, str_statement, effective_parameters, cursor, context
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          )
          ^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
          raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
          self.dialect.do_execute(
          ~~~~~~~~~~~~~~~~~~~~~~~^
              cursor, str_statement, effective_parameters, context
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          )
          ^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
          cursor.execute(statement, parameters)
          ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/mysql/connector/cursor.py", line 615, in execute
          self._handle_result(self._connection.cmd_query(stmt))
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 1046, in cmd_query
          result = self._handle_result(self._send_cmd(ServerCmd.QUERY, query))
        File "/Users/mohammadshahjahan/salah-tracker/.venv/lib/python3.13/site-packages/mysql/connector/connection.py", line 824, in _handle_result
          raise get_exception(packet)
      sqlalchemy.exc.IntegrityError: (mysql.connector.errors.IntegrityError) 1062 (23000): Duplicate entry 'unverifieduser' for key 'users.username'
      [SQL: INSERT INTO users (username, email, password_hash, first_name, last_name, phone_number, location_lat, location_lng, timezone, city, country, fiqh_method, language, notification_enabled, email_notifications, reminder_times, email_verified, created_at, updated_at) VALUES (%(username)s, %(email)s, %(password_hash)s, %(first_name)s, %(last_name)s, %(phone_number)s, %(location_lat)s, %(location_lng)s, %(timezone)s, %(city)s, %(country)s, %(fiqh_method)s, %(language)s, %(notification_enabled)s, %(email_notifications)s, %(reminder_times)s, %(email_verified)s, %(created_at)s, %(updated_at)s)]
      [parameters: {'username': 'unverifieduser', 'email': 'unverified@example.com', 'password_hash': 'pbkdf2:sha256:600000$iBk9JMLGCEF168xY$bd4c09d8e0e69c1b0817d0f1ef1b7246cfed1817db66b220f9e5d7c109646ab8', 'first_name': 'Unverified', 'last_name': 'User', 'phone_number': None, 'location_lat': None, 'location_lng': None, 'timezone': 'UTC', 'city': None, 'country': None, 'fiqh_method': 'shafi', 'language': 'en', 'notification_enabled': 1, 'email_notifications': 1, 'reminder_times': '{"fajr": 15, "dhuhr": 10, "asr": 10, "maghrib": 5, "isha": 10}', 'email_verified': 0, 'created_at': datetime.datetime(2025, 9, 15, 20, 44, 32, 418125), 'updated_at': datetime.datetime(2025, 9, 15, 20, 44, 32, 418127)}]
      (Background on this error at: https://sqlalche.me/e/20/gkpj)

    And I have received a verification email           # None
    When I enter the correct verification code         # None
    And I submit the verification form                 # None
    Then my email should be verified                   # None
    And I should see a success message                 # None
    And the email verification header should disappear # None

  @api
  Scenario: Email verification with incorrect code                 # features/email_verification/email_verification.feature:21
    Given the application is running                               # None
    And a user with unverified email exists                        # None
    Given I am a registered user with unverified email             # None
    When I enter an incorrect verification code                    # None
    And I submit the verification form                             # None
    Then I should see an error message "Invalid verification code" # None
    And my email should remain unverified                          # None

  @api
  Scenario: Email verification with expired code                       # features/email_verification/email_verification.feature:29
    Given the application is running                                   # None
    And a user with unverified email exists                            # None
    Given I am a registered user with unverified email                 # None
    And I have an expired verification code                            # None
    When I enter the expired verification code                         # None
    And I submit the verification form                                 # None
    Then I should see an error message "Verification code has expired" # None
    And my email should remain unverified                              # None

  @api
  Scenario: Resend verification code                         # features/email_verification/email_verification.feature:38
    Given the application is running                         # None
    And a user with unverified email exists                  # None
    Given I am a registered user with unverified email       # None
    When I click "Resend Code"                               # None
    Then I should receive a new verification email           # None
    And I should see a confirmation message                  # None
    And the previous verification code should be invalidated # None

  @ui
  Scenario: Email verification header display                                    # features/email_verification/email_verification.feature:46
    Given the application is running                                             # None
    And a user with unverified email exists                                      # None
    Given I am a logged-in user with unverified email                            # None
    When I navigate to any page                                                  # None
    Then I should see the email verification header                              # None
    And the header should display "Verify your email to receive email reminders" # None
    And the header should have "Verify Now" and "Resend Code" buttons            # None

  @ui
  Scenario: Email verification header dismissal            # features/email_verification/email_verification.feature:54
    Given the application is running                       # None
    And a user with unverified email exists                # None
    Given I am a logged-in user with unverified email      # None
    And I can see the email verification header            # None
    When I click the dismiss button on the header          # None
    Then the header should disappear                       # None
    And the header should not appear again in this session # None

  @api
  Scenario: Automatic email verification during registration                   # features/email_verification/email_verification.feature:62
    Given the application is running                                           # None
    And a user with unverified email exists                                    # None
    Given I am registering a new account                                       # None
    When I complete the registration process                                   # None
    Then an email verification should be automatically sent                    # None
    And I should see a message "Please check your email for verification code" # None
    And the email verification modal should appear                             # None

  @api
  Scenario: Email verification rate limiting                  # features/email_verification/email_verification.feature:70
    Given the application is running                          # None
    And a user with unverified email exists                   # None
    Given I am a registered user with unverified email        # None
    When I request verification codes multiple times rapidly  # None
    Then I should be rate limited after 5 attempts            # None
    And I should see an error message about too many attempts # None

  @api
  Scenario: Email verification for already verified user           # features/email_verification/email_verification.feature:77
    Given the application is running                               # None
    And a user with unverified email exists                        # None
    Given I am a registered user with verified email               # None
    When I try to verify my email again                            # None
    Then I should see an error message "Email is already verified" # None
    And no new verification code should be sent                    # None

Feature: Prayer Reminders # features/notifications/prayer_reminders.feature:1
  As a registered user
  I want to receive prayer reminders
  So that I don't miss my prayers
  Feature: Prayer Reminders  # features/notifications/prayer_reminders.feature:1

  @smoke @api
  Scenario: Receive prayer reminder before prayer time    # features/notifications/prayer_reminders.feature:12
    Given the application is running                      # features/steps/authentication_steps.py:12
    And I am a registered user with verified email        # features/steps/authentication_steps.py:110
    And I have set my prayer reminder preferences         # features/steps/dashboard_steps.py:19
    Given it is 10 minutes before Dhuhr prayer time       # features/steps/notification_steps.py:18
    When the reminder system runs                         # features/steps/notification_steps.py:122
    Then I should receive a prayer reminder email         # features/steps/notification_steps.py:182
      ASSERT FAILED:

    And the email should contain the prayer name and time # None
    And the email should contain a completion link        # None

  @api
  Scenario: Receive prayer reminder for missed prayer       # features/notifications/prayer_reminders.feature:20
    Given the application is running                        # None
    And I am a registered user with verified email          # None
    And I have set my prayer reminder preferences           # None
    Given the Dhuhr prayer time has passed                  # None
    And I have not completed the prayer                     # None
    When the reminder system runs                           # None
    Then I should receive a missed prayer reminder          # None
    And the email should contain a completion link for qada # None

  @api
  Scenario: Do not receive reminder for completed prayer  # features/notifications/prayer_reminders.feature:28
    Given the application is running                      # None
    And I am a registered user with verified email        # None
    And I have set my prayer reminder preferences         # None
    Given I have already completed the Dhuhr prayer       # None
    When the reminder system runs                         # None
    Then I should not receive a prayer reminder           # None

  @api
  Scenario: Receive reminder with correct timezone               # features/notifications/prayer_reminders.feature:34
    Given the application is running                             # None
    And I am a registered user with verified email               # None
    And I have set my prayer reminder preferences                # None
    Given I am in timezone "Asia/Kolkata"                        # None
    And it is 10 minutes before Dhuhr prayer time in my timezone # None
    When the reminder system runs                                # None
    Then I should receive a prayer reminder                      # None
    And the prayer time should be displayed in my timezone       # None

  @api
  Scenario: Receive reminder with family member information  # features/notifications/prayer_reminders.feature:42
    Given the application is running                         # None
    And I am a registered user with verified email           # None
    And I have set my prayer reminder preferences            # None
    Given I have family members added to my account          # None
    And it is 10 minutes before Dhuhr prayer time            # None
    When the reminder system runs                            # None
    Then I should receive a prayer reminder                  # None
    And the email should include family member prayer status # None

  @api
  Scenario: Reminder rate limiting                            # features/notifications/prayer_reminders.feature:50
    Given the application is running                          # None
    And I am a registered user with verified email            # None
    And I have set my prayer reminder preferences             # None
    Given I have requested multiple reminders rapidly         # None
    When I try to request another reminder                    # None
    Then I should be rate limited                             # None
    And I should see an error message about too many requests # None

  @ui
  Scenario: Configure reminder preferences         # features/notifications/prayer_reminders.feature:57
    Given the application is running               # None
    And I am a registered user with verified email # None
    And I have set my prayer reminder preferences  # None
    Given I am on the settings page                # None
    When I configure my reminder preferences       # None
    Then my preferences should be saved            # None
    And I should see a confirmation message        # None

  @ui
  Scenario: Disable prayer reminders               # features/notifications/prayer_reminders.feature:64
    Given the application is running               # None
    And I am a registered user with verified email # None
    And I have set my prayer reminder preferences  # None
    Given I am on the settings page                # None
    When I disable prayer reminders                # None
    Then I should not receive any prayer reminders # None
    And my preference should be saved              # None

  @api
  Scenario: Reminder delivery failure handling        # features/notifications/prayer_reminders.feature:71
    Given the application is running                  # None
    And I am a registered user with verified email    # None
    And I have set my prayer reminder preferences     # None
    Given my email address is invalid                 # None
    When the reminder system tries to send a reminder # None
    Then the delivery should fail gracefully          # None
    And the failure should be logged                  # None
    And I should not receive the reminder             # None

  @api
  Scenario: Bulk reminder processing                    # features/notifications/prayer_reminders.feature:79
    Given the application is running                    # None
    And I am a registered user with verified email      # None
    And I have set my prayer reminder preferences       # None
    Given there are 100 users who need reminders        # None
    When the reminder system processes all users        # None
    Then all users should receive their reminders       # None
    And the processing should complete within 5 minutes # None

Feature: Prayer Completion # features/prayer_tracking/prayer_completion.feature:1
  As a logged-in user
  I want to mark my prayers as completed
  So that I can track my prayer consistency
  Feature: Prayer Completion  # features/prayer_tracking/prayer_completion.feature:1

  @smoke @api
  Scenario: Complete prayer during prayer time window         # features/prayer_tracking/prayer_completion.feature:12
    Given the application is running                          # features/steps/authentication_steps.py:12
    And I am logged in as a user                              # features/steps/prayer_completion_steps.py:15
    And today's prayer times are available                    # None
    Given it is currently within the Dhuhr prayer time window # None
    When I mark the Dhuhr prayer as completed                 # None
    Then the prayer should be marked as "completed"           # None
    And I should see a success message                        # None
    And the prayer status should be updated in real-time      # None

  @api
  Scenario: Complete prayer after prayer time window          # features/prayer_tracking/prayer_completion.feature:20
    Given the application is running                          # None
    And I am logged in as a user                              # None
    And today's prayer times are available                    # None
    Given the Dhuhr prayer time window has passed             # None
    When I mark the Dhuhr prayer as completed                 # None
    Then the prayer should be marked as "qada"                # None
    And I should see a message about completing missed prayer # None
    And the prayer status should be updated accordingly       # None

  @api
  Scenario: Complete prayer before prayer time window               # features/prayer_tracking/prayer_completion.feature:28
    Given the application is running                                # None
    And I am logged in as a user                                    # None
    And today's prayer times are available                          # None
    Given it is before the Dhuhr prayer time window                 # None
    When I try to mark the Dhuhr prayer as completed                # None
    Then I should see an error message "Cannot complete prayer yet" # None
    And the prayer should remain in "pending" status                # None

  @api
  Scenario: Complete prayer with timezone awareness      # features/prayer_tracking/prayer_completion.feature:35
    Given the application is running                     # None
    And I am logged in as a user                         # None
    And today's prayer times are available               # None
    Given I am in timezone "Asia/Kolkata"                # None
    And the current time is "14:30" in my timezone       # None
    And the Dhuhr prayer time is "12:15" in my timezone  # None
    When I mark the Dhuhr prayer as completed            # None
    Then the prayer should be marked as "completed"      # None
    And the completion time should be recorded correctly # None

  @ui
  Scenario: Prayer completion via UI                            # features/prayer_tracking/prayer_completion.feature:44
    Given the application is running                            # None
    And I am logged in as a user                                # None
    And today's prayer times are available                      # None
    Given I am on the prayers page                              # None
    And I can see today's prayer times                          # None
    When I click the "Mark as Complete" button for Dhuhr prayer # None
    Then the button should change to "Completed"                # None
    And the prayer card should show completed status            # None
    And I should see a success notification                     # None

  @ui
  Scenario: Prayer completion via completion link            # features/prayer_tracking/prayer_completion.feature:53
    Given the application is running                         # None
    And I am logged in as a user                             # None
    And today's prayer times are available                   # None
    Given I have received a prayer completion link via email # None
    When I click the completion link                         # None
    Then I should be taken to the prayer completion page     # None
    And I should see the prayer details                      # None
    When I click "Mark as Complete"                          # None
    Then the prayer should be marked as completed            # None
    And I should see a success page                          # None

  @api
  Scenario: Prayer completion with notes            # features/prayer_tracking/prayer_completion.feature:63
    Given the application is running                # None
    And I am logged in as a user                    # None
    And today's prayer times are available          # None
    Given it is within the Dhuhr prayer time window # None
    When I mark the Dhuhr prayer as completed       # None
    And I add a note "Prayed at mosque"             # None
    Then the prayer should be marked as "completed" # None
    And the note should be saved                    # None
    And I should be able to view the note later     # None

  @api
  Scenario: Prayer completion validation                          # features/prayer_tracking/prayer_completion.feature:72
    Given the application is running                              # None
    And I am logged in as a user                                  # None
    And today's prayer times are available                        # None
    Given I am logged in                                          # None
    When I try to complete a prayer without proper authentication # None
    Then I should see an authentication error                     # None
    And the prayer should not be completed                        # None

  @api
  Scenario: Prayer completion for non-existent prayer     # features/prayer_tracking/prayer_completion.feature:79
    Given the application is running                      # None
    And I am logged in as a user                          # None
    And today's prayer times are available                # None
    Given I am logged in                                  # None
    When I try to complete a prayer that doesn't exist    # None
    Then I should see an error message "Prayer not found" # None
    And no completion should be recorded                  # None

  @api
  Scenario: Prayer completion rate limiting                       # features/prayer_tracking/prayer_completion.feature:86
    Given the application is running                              # None
    And I am logged in as a user                                  # None
    And today's prayer times are available                        # None
    Given I am logged in                                          # None
    When I try to complete the same prayer multiple times rapidly # None
    Then I should be rate limited                                 # None
    And I should see an error message about too many requests     # None

Feature: Prayer State Matrix - Comprehensive Date and Time Validation # features/prayer_tracking/prayer_state_matrix.feature:1
  As a Muslim user
  I want to validate prayer states across different dates and times
  So that I can ensure accurate prayer tracking in all scenarios
  Feature: Prayer State Matrix - Comprehensive Date and Time Validation  # features/prayer_tracking/prayer_state_matrix.feature:1

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.1 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:22
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-20 04:30"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "future" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "future" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "future" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.2 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:23
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 05:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "pending" state                                           # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "future" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "future" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.3 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:24
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 07:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "future" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "future" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.4 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:25
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 13:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "pending" state                                           # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "future" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.5 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:26
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 14:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "pending" state                                           # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "future" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.6 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:27
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 16:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "pending" state                                             # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.7 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:28
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 17:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "pending" state                                             # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.8 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:29
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 18:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "future" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.9 Prayer States Matrix                 # features/prayer_tracking/prayer_state_matrix.feature:30
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 19:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "pending" state                                         # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "future" state                                             # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.10 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:31
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 20:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.11 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:32
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 21:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.12 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:33
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 22:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.13 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:34
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-21 23:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.14 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:35
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-22 00:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.15 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:36
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-22 01:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.16 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:37
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-22 02:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.17 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:38
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-22 03:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

  @smoke @api @matrix @comprehensive
  Scenario Outline: Prayer state validation matrix -- @1.18 Prayer States Matrix                # features/prayer_tracking/prayer_state_matrix.feature:39
    Given the application is running                                                            # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata" and created_at 2020-01-01 03:00 # features/steps/time_based_prayer_steps.py:35
    Given I am checking the prayer times of "2025-06-21" at time "2025-06-22 04:00"             # features/steps/prayer_matrix_steps.py:17
    Then the Fajr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Dhuhr prayer should be in "missed" state                                            # features/steps/time_based_prayer_steps.py:119
    And the Asr prayer should be in "missed" state                                              # features/steps/time_based_prayer_steps.py:119
    And the Maghrib prayer should be in "missed" state                                          # features/steps/time_based_prayer_steps.py:119
    And the Isha prayer should be in "pending" state                                            # features/steps/time_based_prayer_steps.py:119

Feature: Time-Based Prayer State Transitions # features/prayer_tracking/time_based_prayer_states.feature:1
  As a Muslim user
  I want to understand how prayer states change based on time
  So that I can track my prayers accurately according to Islamic timing
  Feature: Time-Based Prayer State Transitions  # features/prayer_tracking/time_based_prayer_states.feature:1

  @smoke @api @time-based
  Scenario: Fajr prayer state transitions throughout the day                   # features/prayer_tracking/time_based_prayer_states.feature:12
    Given the application is running                                           # features/steps/authentication_steps.py:12
    Given I am logged in as a user with timezone "Asia/Kolkata"                # features/steps/time_based_prayer_steps.py:15
    Given I am checking the namaz times of 2025-09-16 at time 2025-09-16 12:10 # features/steps/prayer_completion_steps.py:35
    Then All the namaz should be in future                                     # features/steps/time_based_prayer_steps.py:431
      ASSERT FAILED:

----
CAPTURED STDOUT: scenario
{'success': True, 'prayers': [{'id': 101, 'prayer_type': 'Fajr', 'prayer_time': '05:10', 'completed': True, 'can_complete': False, 'is_missed': True, 'can_mark_qada': True, 'is_late': False, 'completion': {'id': 50, 'user_id': 32, 'prayer_id': 101, 'marked_at': None, 'status': 'MISSED', 'notes': None, 'prayer': {'id': 101, 'prayer_type': 'Fajr', 'prayer_date': '2025-09-16', 'prayer_time': '05:10', 'location_lat': None, 'location_lng': None, 'timezone': 'UTC', 'created_at': '2025-09-15T20:44:37'}}, 'prayer_status': 'missed', 'status_color': 'red', 'status_text': 'Missed', 'time_window': {'start_time': '05:10', 'end_time': '06:09', 'start_datetime': '2025-09-16T05:10:00+05:30', 'end_datetime': '2025-09-16T06:09:00+05:30'}, 'current_time': '12:10', 'time_status': 'after'}, {'id': 102, 'prayer_type': 'Dhuhr', 'prayer_time': '12:14', 'completed': False, 'can_complete': False, 'is_missed': False, 'can_mark_qada': False, 'is_late': False, 'completion': None, 'prayer_status': 'future', 'status_color': 'gray', 'status_text': 'Future', 'time_window': {'start_time': '12:14', 'end_time': '15:14', 'start_datetime': '2025-09-16T12:14:00+05:30', 'end_datetime': '2025-09-16T15:14:00+05:30'}, 'current_time': '12:10', 'time_status': 'before'}, {'id': 103, 'prayer_type': 'Asr', 'prayer_time': '15:32', 'completed': False, 'can_complete': False, 'is_missed': False, 'can_mark_qada': False, 'is_late': False, 'completion': None, 'prayer_status': 'future', 'status_color': 'gray', 'status_text': 'Future', 'time_window': {'start_time': '15:32', 'end_time': '17:32', 'start_datetime': '2025-09-16T15:32:00+05:30', 'end_datetime': '2025-09-16T17:32:00+05:30'}, 'current_time': '12:10', 'time_status': 'before'}, {'id': 104, 'prayer_type': 'Maghrib', 'prayer_time': '18:20', 'completed': False, 'can_complete': False, 'is_missed': False, 'can_mark_qada': False, 'is_late': False, 'completion': None, 'prayer_status': 'future', 'status_color': 'gray', 'status_text': 'Future', 'time_window': {'start_time': '18:20', 'end_time': '18:50', 'start_datetime': '2025-09-16T18:20:00+05:30', 'end_datetime': '2025-09-16T18:50:00+05:30'}, 'current_time': '12:10', 'time_status': 'before'}, {'id': 105, 'prayer_type': 'Isha', 'prayer_time': '19:18', 'completed': False, 'can_complete': False, 'is_missed': False, 'can_mark_qada': False, 'is_late': False, 'completion': None, 'prayer_status': 'future', 'status_color': 'gray', 'status_text': 'Future', 'time_window': {'start_time': '19:18', 'end_time': '03:18', 'start_datetime': '2025-09-16T19:18:00+05:30', 'end_datetime': '2025-09-18T03:18:00+05:30'}, 'current_time': '12:10', 'time_status': 'before'}], 'date': '2025-09-16', 'user_timezone': 'Asia/Kolkata'}
---- CAPTURED_SCENARIO_OUTPUT_END ----

  @api @time-based
  Scenario: Dhuhr prayer state transitions throughout the day   # features/prayer_tracking/time_based_prayer_states.feature:40
    Given the application is running                            # None
    Given I am logged in as a user with timezone "Asia/Kolkata" # None
    Given the current time is "11:00" in my timezone            # None
    When I check the Dhuhr prayer status                        # None
    Then the Dhuhr prayer should be in "future" state           # None
    And I should not be able to complete the Dhuhr prayer       # None
    And I should not be able to mark Dhuhr as qada              # None
    Given the current time is "12:15" in my timezone            # None
    When I check the Dhuhr prayer status                        # None
    Then the Dhuhr prayer should be in "pending" state          # None
    And I should be able to complete the Dhuhr prayer           # None
    And I should not be able to mark Dhuhr as qada              # None
    Given the current time is "14:00" in my timezone            # None
    When I check the Dhuhr prayer status                        # None
    Then the Dhuhr prayer should be in "pending" state          # None
    And I should be able to complete the Dhuhr prayer           # None
    And I should not be able to mark Dhuhr as qada              # None
    Given the current time is "15:45" in my timezone            # None
    When I check the Dhuhr prayer status                        # None
    Then the Dhuhr prayer should be in "missed" state           # None
    And I should not be able to complete the Dhuhr prayer       # None
    And I should be able to mark Dhuhr as qada                  # None

  @api @time-based
  Scenario: Asr prayer state transitions throughout the day     # features/prayer_tracking/time_based_prayer_states.feature:70
    Given the application is running                            # None
    Given I am logged in as a user with timezone "Asia/Kolkata" # None
    Given the current time is "14:00" in my timezone            # None
    When I check the Asr prayer status                          # None
    Then the Asr prayer should be in "future" state             # None
    And I should not be able to complete the Asr prayer         # None
    And I should not be able to mark Asr as qada                # None
    Given the current time is "15:45" in my timezone            # None
    When I check the Asr prayer status                          # None
    Then the Asr prayer should be in "pending" state            # None
    And I should be able to complete the Asr prayer             # None
    And I should not be able to mark Asr as qada                # None
    Given the current time is "17:00" in my timezone            # None
    When I check the Asr prayer status                          # None
    Then the Asr prayer should be in "pending" state            # None
    And I should be able to complete the Asr prayer             # None
    And I should not be able to mark Asr as qada                # None
    Given the current time is "18:30" in my timezone            # None
    When I check the Asr prayer status                          # None
    Then the Asr prayer should be in "missed" state             # None
    And I should not be able to complete the Asr prayer         # None
    And I should be able to mark Asr as qada                    # None

  @api @time-based
  Scenario: Maghrib prayer state transitions throughout the day  # features/prayer_tracking/time_based_prayer_states.feature:100
    Given the application is running                             # None
    Given I am logged in as a user with timezone "Asia/Kolkata"  # None
    Given the current time is "17:00" in my timezone             # None
    When I check the Maghrib prayer status                       # None
    Then the Maghrib prayer should be in "future" state          # None
    And I should not be able to complete the Maghrib prayer      # None
    And I should not be able to mark Maghrib as qada             # None
    Given the current time is "18:30" in my timezone             # None
    When I check the Maghrib prayer status                       # None
    Then the Maghrib prayer should be in "pending" state         # None
    And I should be able to complete the Maghrib prayer          # None
    And I should not be able to mark Maghrib as qada             # None
    Given the current time is "19:00" in my timezone             # None
    When I check the Maghrib prayer status                       # None
    Then the Maghrib prayer should be in "pending" state         # None
    And I should be able to complete the Maghrib prayer          # None
    And I should not be able to mark Maghrib as qada             # None
    Given the current time is "19:45" in my timezone             # None
    When I check the Maghrib prayer status                       # None
    Then the Maghrib prayer should be in "missed" state          # None
    And I should not be able to complete the Maghrib prayer      # None
    And I should be able to mark Maghrib as qada                 # None

  @api @time-based
  Scenario: Isha prayer state transitions throughout the day    # features/prayer_tracking/time_based_prayer_states.feature:130
    Given the application is running                            # None
    Given I am logged in as a user with timezone "Asia/Kolkata" # None
    Given the current time is "18:00" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "future" state            # None
    And I should not be able to complete the Isha prayer        # None
    And I should not be able to mark Isha as qada               # None
    Given the current time is "19:45" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "pending" state           # None
    And I should be able to complete the Isha prayer            # None
    And I should not be able to mark Isha as qada               # None
    Given the current time is "22:00" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "pending" state           # None
    And I should be able to complete the Isha prayer            # None
    And I should not be able to mark Isha as qada               # None
    Given the current time is "23:30" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "pending" state           # None
    And I should be able to complete the Isha prayer            # None
    And I should not be able to mark Isha as qada               # None
    Given the current time is "03:00" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "missed" state            # None
    And I should not be able to complete the Isha prayer        # None
    And I should be able to mark Isha as qada                   # None

  @api @time-based @completion
  Scenario: Prayer completion state transitions                                     # features/prayer_tracking/time_based_prayer_states.feature:167
    Given the application is running                                                # None
    Given I am logged in as a user with timezone "Asia/Kolkata"                     # None
    Given the current time is "06:00" in my timezone                                # None
    And the Fajr prayer is in "pending" state                                       # None
    When I mark the Fajr prayer as completed                                        # None
    Then the Fajr prayer should be in "completed" state                             # None
    And I should not be able to complete the Fajr prayer again                      # None
    And I should not be able to mark Fajr as qada                                   # None
    Given the current time is "16:00" in my timezone                                # None
    And the Dhuhr prayer is in "missed" state                                       # None
    When I try to mark the Dhuhr prayer as completed                                # None
    Then I should see an error message "Cannot complete prayer outside time window" # None
    And the Dhuhr prayer should remain in "missed" state                            # None
    Given the current time is "16:00" in my timezone                                # None
    And the Dhuhr prayer is in "missed" state                                       # None
    When I mark the Dhuhr prayer as qada                                            # None
    Then the Dhuhr prayer should be in "qada" state                                 # None
    And I should not be able to complete the Dhuhr prayer                           # None
    And I should not be able to mark Dhuhr as qada again                            # None

  @api @time-based @timezone
  Scenario: Timezone-aware prayer state transitions                        # features/prayer_tracking/time_based_prayer_states.feature:192
    Given the application is running                                       # None
    Given I am logged in as a user with timezone "Asia/Kolkata"            # None
    Given I am logged in as a user with timezone "America/New_York"        # None
    And the current time is "07:00" in my timezone                         # None
    When I check the Fajr prayer status                                    # None
    Then the Fajr prayer should be in "pending" state                      # None
    And the prayer time should be displayed in "America/New_York" timezone # None
    Given I am logged in as a user with timezone "Europe/London"           # None
    And the current time is "12:00" in my timezone                         # None
    When I check the Dhuhr prayer status                                   # None
    Then the Dhuhr prayer should be in "pending" state                     # None
    And the prayer time should be displayed in "Europe/London" timezone    # None
    Given I am logged in as a user with timezone "Asia/Dubai"              # None
    And the current time is "18:00" in my timezone                         # None
    When I check the Maghrib prayer status                                 # None
    Then the Maghrib prayer should be in "pending" state                   # None
    And the prayer time should be displayed in "Asia/Dubai" timezone       # None

  @api @time-based @edge-cases
  Scenario: Edge cases for prayer state transitions                  # features/prayer_tracking/time_based_prayer_states.feature:215
    Given the application is running                                 # None
    Given I am logged in as a user with timezone "Asia/Kolkata"      # None
    Given the current time is "12:15:00" in my timezone with seconds # None
    When I check the Dhuhr prayer status                             # None
    Then the Dhuhr prayer should be in "pending" state               # None
    And I should be able to complete the Dhuhr prayer                # None
    Given the current time is "15:45:00" in my timezone with seconds # None
    When I check the Dhuhr prayer status                             # None
    Then the Dhuhr prayer should be in "pending" state               # None
    And I should be able to complete the Dhuhr prayer                # None
    Given the current time is "15:45:01" in my timezone with seconds # None
    When I check the Dhuhr prayer status                             # None
    Then the Dhuhr prayer should be in "missed" state                # None
    And I should not be able to complete the Dhuhr prayer            # None
    Given the current time is "12:14:59" in my timezone with seconds # None
    When I check the Dhuhr prayer status                             # None
    Then the Dhuhr prayer should be in "future" state                # None
    And I should not be able to complete the Dhuhr prayer            # None

  @api @time-based @midnight
  Scenario: Midnight prayer state transitions                   # features/prayer_tracking/time_based_prayer_states.feature:241
    Given the application is running                            # None
    Given I am logged in as a user with timezone "Asia/Kolkata" # None
    Given the current time is "23:59" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "pending" state           # None
    And I should be able to complete the Isha prayer            # None
    Given the current time is "00:30" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "pending" state           # None
    And I should be able to complete the Isha prayer            # None
    Given the current time is "02:00" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "pending" state           # None
    And I should be able to complete the Isha prayer            # None
    Given the current time is "05:20" in my timezone            # None
    When I check the Isha prayer status                         # None
    Then the Isha prayer should be in "missed" state            # None
    And I should not be able to complete the Isha prayer        # None

  @api @time-based @daylight-savings
  Scenario: Daylight savings time prayer state transitions          # features/prayer_tracking/time_based_prayer_states.feature:267
    Given the application is running                                # None
    Given I am logged in as a user with timezone "Asia/Kolkata"     # None
    Given I am logged in as a user with timezone "America/New_York" # None
    And it is daylight savings time                                 # None
    And the current time is "12:00" in my timezone                  # None
    When I check the Dhuhr prayer status                            # None
    Then the Dhuhr prayer should be in "pending" state              # None
    And the prayer time should account for daylight savings         # None
    Given I am logged in as a user with timezone "America/New_York" # None
    And daylight savings has ended                                  # None
    And the current time is "12:00" in my timezone                  # None
    When I check the Dhuhr prayer status                            # None
    Then the Dhuhr prayer should be in "pending" state              # None
    And the prayer time should account for standard time            # None

